<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Generics and substitutions - Guide to Rustc Development</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A guide to developing rustc">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded affix "><a href="about-this-guide.html">About this guide</a></li><li class="spacer"></li><li class="expanded "><a href="part-1-intro.html"><strong aria-hidden="true">1.</strong> Part 1: Building, debugging, and contributing to Rustc</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="compiler-team.html"><strong aria-hidden="true">1.1.</strong> About the compiler team</a></li><li class=""><a href="building/how-to-build-and-run.html"><strong aria-hidden="true">1.2.</strong> How to Build and Run the Compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="building/suggested.html"><strong aria-hidden="true">1.2.1.</strong> Suggested Workflows</a></li><li class=""><a href="building/bootstrapping.html"><strong aria-hidden="true">1.2.2.</strong> Bootstrapping</a></li><li class=""><a href="building/build-install-distribution-artifacts.html"><strong aria-hidden="true">1.2.3.</strong> Distribution artifacts</a></li><li class=""><a href="building/compiler-documenting.html"><strong aria-hidden="true">1.2.4.</strong> Documenting Compiler</a></li><li class=""><a href="building/ctags.html"><strong aria-hidden="true">1.2.5.</strong> ctags</a></li></ol></li><li class=""><a href="tests/intro.html"><strong aria-hidden="true">1.3.</strong> The compiler testing framework</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="tests/running.html"><strong aria-hidden="true">1.3.1.</strong> Running tests</a></li><li class=""><a href="tests/adding.html"><strong aria-hidden="true">1.3.2.</strong> Adding new tests</a></li><li class=""><a href="compiletest.html"><strong aria-hidden="true">1.3.3.</strong> Using compiletest + commands to control test execution</a></li></ol></li><li class=""><a href="walkthrough.html"><strong aria-hidden="true">1.4.</strong> Walkthrough: a typical contribution</a></li><li class=""><a href="bug-fix-procedure.html"><strong aria-hidden="true">1.5.</strong> Bug Fix Procedure</a></li><li class=""><a href="implementing_new_features.html"><strong aria-hidden="true">1.6.</strong> Implementing new features</a></li><li class=""><a href="stability.html"><strong aria-hidden="true">1.7.</strong> Stability attributes</a></li><li class=""><a href="stabilization_guide.html"><strong aria-hidden="true">1.8.</strong> Stabilizing Features</a></li><li class=""><a href="compiler-debugging.html"><strong aria-hidden="true">1.9.</strong> Debugging the Compiler</a></li><li class=""><a href="profiling.html"><strong aria-hidden="true">1.10.</strong> Profiling the compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="profiling/with_perf.html"><strong aria-hidden="true">1.10.1.</strong> with the linux perf tool</a></li></ol></li><li class=""><a href="conventions.html"><strong aria-hidden="true">1.11.</strong> Coding conventions</a></li><li class=""><a href="crates-io.html"><strong aria-hidden="true">1.12.</strong> crates.io Dependencies</a></li><li class=""><a href="diagnostics.html"><strong aria-hidden="true">1.13.</strong> Emitting Errors and other Diagnostics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="diagnostics/lintstore.html"><strong aria-hidden="true">1.13.1.</strong> LintStore</a></li><li class=""><a href="diagnostics/diagnostic-codes.html"><strong aria-hidden="true">1.13.2.</strong> Diagnostic Codes</a></li></ol></li><li class=""><a href="ice-breaker/about.html"><strong aria-hidden="true">1.14.</strong> ICE-breaker teams</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="ice-breaker/cleanup-crew.html"><strong aria-hidden="true">1.14.1.</strong> &quot;Cleanup Crew&quot; ICE-breakers</a></li><li class=""><a href="ice-breaker/llvm.html"><strong aria-hidden="true">1.14.2.</strong> LLVM ICE-breakers</a></li></ol></li><li class=""><a href="licenses.html"><strong aria-hidden="true">1.15.</strong> Licenses</a></li></ol></li><li class="expanded "><a href="part-2-intro.html"><strong aria-hidden="true">2.</strong> Part 2: How rustc works</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="high-level-overview.html"><strong aria-hidden="true">2.1.</strong> High-level overview of the compiler source</a></li><li class=""><a href="rustc-driver.html"><strong aria-hidden="true">2.2.</strong> The Rustc Driver and Interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="rustdoc.html"><strong aria-hidden="true">2.2.1.</strong> Rustdoc</a></li></ol></li><li class=""><a href="query.html"><strong aria-hidden="true">2.3.</strong> Queries: demand-driven compilation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="queries/query-evaluation-model-in-detail.html"><strong aria-hidden="true">2.3.1.</strong> The Query Evaluation Model in Detail</a></li><li class=""><a href="queries/incremental-compilation.html"><strong aria-hidden="true">2.3.2.</strong> Incremental compilation</a></li><li class=""><a href="queries/incremental-compilation-in-detail.html"><strong aria-hidden="true">2.3.3.</strong> Incremental compilation In Detail</a></li><li class=""><a href="incrcomp-debugging.html"><strong aria-hidden="true">2.3.4.</strong> Debugging and Testing</a></li><li class=""><a href="queries/profiling.html"><strong aria-hidden="true">2.3.5.</strong> Profiling Queries</a></li><li class=""><a href="salsa.html"><strong aria-hidden="true">2.3.6.</strong> Salsa</a></li></ol></li><li class=""><a href="memory.html"><strong aria-hidden="true">2.4.</strong> Memory Management in Rustc</a></li><li class=""><a href="the-parser.html"><strong aria-hidden="true">2.5.</strong> Lexing and Parsing</a></li><li class=""><a href="test-implementation.html"><strong aria-hidden="true">2.6.</strong> #[test] Implementation</a></li><li class=""><a href="panic-implementation.html"><strong aria-hidden="true">2.7.</strong> Panic Implementation</a></li><li class=""><a href="macro-expansion.html"><strong aria-hidden="true">2.8.</strong> Macro expansion</a></li><li class=""><a href="name-resolution.html"><strong aria-hidden="true">2.9.</strong> Name resolution</a></li><li class=""><a href="hir.html"><strong aria-hidden="true">2.10.</strong> The HIR (High-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="lowering.html"><strong aria-hidden="true">2.10.1.</strong> Lowering AST to HIR</a></li><li class=""><a href="hir-debugging.html"><strong aria-hidden="true">2.10.2.</strong> Debugging</a></li></ol></li><li class=""><a href="closure.html"><strong aria-hidden="true">2.11.</strong> Closure expansion</a></li><li class="expanded "><a href="ty.html"><strong aria-hidden="true">2.12.</strong> The ty module: representing types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="expanded "><a href="generics.html" class="active"><strong aria-hidden="true">2.12.1.</strong> Generics and substitutions</a></li><li class=""><a href="ty-fold.html"><strong aria-hidden="true">2.12.2.</strong> TypeFolder and TypeFoldable</a></li><li class=""><a href="generic_arguments.html"><strong aria-hidden="true">2.12.3.</strong> Generic arguments</a></li></ol></li><li class=""><a href="type-inference.html"><strong aria-hidden="true">2.13.</strong> Type inference</a></li><li class=""><a href="traits/resolution.html"><strong aria-hidden="true">2.14.</strong> Trait solving (old-style)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="traits/hrtb.html"><strong aria-hidden="true">2.14.1.</strong> Higher-ranked trait bounds</a></li><li class=""><a href="traits/caching.html"><strong aria-hidden="true">2.14.2.</strong> Caching subtleties</a></li><li class=""><a href="traits/specialization.html"><strong aria-hidden="true">2.14.3.</strong> Specialization</a></li></ol></li><li class=""><a href="traits/index.html"><strong aria-hidden="true">2.15.</strong> Trait solving (new-style)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="traits/lowering-to-logic.html"><strong aria-hidden="true">2.15.1.</strong> Lowering to logic</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="traits/goals-and-clauses.html"><strong aria-hidden="true">2.15.1.1.</strong> Goals and clauses</a></li><li class=""><a href="traits/associated-types.html"><strong aria-hidden="true">2.15.1.2.</strong> Equality and associated types</a></li><li class=""><a href="traits/implied-bounds.html"><strong aria-hidden="true">2.15.1.3.</strong> Implied bounds</a></li><li class=""><a href="traits/regions.html"><strong aria-hidden="true">2.15.1.4.</strong> Region constraints</a></li><li class=""><a href="traits/lowering-module.html"><strong aria-hidden="true">2.15.1.5.</strong> The lowering module in rustc</a></li><li class=""><a href="traits/lowering-rules.html"><strong aria-hidden="true">2.15.1.6.</strong> Lowering rules</a></li><li class=""><a href="traits/wf.html"><strong aria-hidden="true">2.15.1.7.</strong> Well-formedness checking</a></li></ol></li><li class=""><a href="traits/canonical-queries.html"><strong aria-hidden="true">2.15.2.</strong> Canonical queries</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="traits/canonicalization.html"><strong aria-hidden="true">2.15.2.1.</strong> Canonicalization</a></li></ol></li><li class=""><a href="traits/slg.html"><strong aria-hidden="true">2.15.3.</strong> The SLG solver</a></li><li class=""><a href="traits/chalk-overview.html"><strong aria-hidden="true">2.15.4.</strong> An Overview of Chalk</a></li><li class=""><a href="traits/bibliography.html"><strong aria-hidden="true">2.15.5.</strong> Bibliography</a></li></ol></li><li class=""><a href="type-checking.html"><strong aria-hidden="true">2.16.</strong> Type checking</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="method-lookup.html"><strong aria-hidden="true">2.16.1.</strong> Method Lookup</a></li><li class=""><a href="variance.html"><strong aria-hidden="true">2.16.2.</strong> Variance</a></li><li class=""><a href="opaque-types-type-alias-impl-trait.html"><strong aria-hidden="true">2.16.3.</strong> Opaque Types</a></li></ol></li><li class=""><a href="mir/index.html"><strong aria-hidden="true">2.17.</strong> The MIR (Mid-level IR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="mir/construction.html"><strong aria-hidden="true">2.17.1.</strong> MIR construction</a></li><li class=""><a href="mir/visitor.html"><strong aria-hidden="true">2.17.2.</strong> MIR visitor and traversal</a></li><li class=""><a href="mir/passes.html"><strong aria-hidden="true">2.17.3.</strong> MIR passes: getting the MIR for a function</a></li><li class=""><a href="mir/optimizations.html"><strong aria-hidden="true">2.17.4.</strong> MIR optimizations</a></li><li class=""><a href="mir/debugging.html"><strong aria-hidden="true">2.17.5.</strong> Debugging</a></li></ol></li><li class=""><a href="borrow_check.html"><strong aria-hidden="true">2.18.</strong> The borrow checker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="borrow_check/moves_and_initialization.html"><strong aria-hidden="true">2.18.1.</strong> Tracking moves and initialization</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="borrow_check/moves_and_initialization/move_paths.html"><strong aria-hidden="true">2.18.1.1.</strong> Move paths</a></li></ol></li><li class=""><a href="borrow_check/type_check.html"><strong aria-hidden="true">2.18.2.</strong> MIR type checker</a></li><li class=""><a href="borrow_check/region_inference.html"><strong aria-hidden="true">2.18.3.</strong> Region inference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="borrow_check/region_inference/constraint_propagation.html"><strong aria-hidden="true">2.18.3.1.</strong> Constraint propagation</a></li><li class=""><a href="borrow_check/region_inference/lifetime_parameters.html"><strong aria-hidden="true">2.18.3.2.</strong> Lifetime parameters</a></li><li class=""><a href="borrow_check/region_inference/member_constraints.html"><strong aria-hidden="true">2.18.3.3.</strong> Member constraints</a></li><li class=""><a href="borrow_check/region_inference/placeholders_and_universes.html"><strong aria-hidden="true">2.18.3.4.</strong> Placeholders and universes</a></li><li class=""><a href="borrow_check/region_inference/closure_constraints.html"><strong aria-hidden="true">2.18.3.5.</strong> Closure constraints</a></li><li class=""><a href="borrow_check/region_inference/error_reporting.html"><strong aria-hidden="true">2.18.3.6.</strong> Error reporting</a></li></ol></li><li class=""><a href="borrow_check/two_phase_borrows.html"><strong aria-hidden="true">2.18.4.</strong> Two-phase-borrows</a></li></ol></li><li class=""><a href="const-eval.html"><strong aria-hidden="true">2.19.</strong> Constant evaluation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="miri.html"><strong aria-hidden="true">2.19.1.</strong> miri const evaluator</a></li></ol></li><li class=""><a href="param_env.html"><strong aria-hidden="true">2.20.</strong> Parameter Environments</a></li><li class=""><a href="backend/backend.html"><strong aria-hidden="true">2.21.</strong> Compiler Backend</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="backend/monomorph.html"><strong aria-hidden="true">2.21.1.</strong> Monomorphization</a></li><li class=""><a href="backend/lowering-mir.html"><strong aria-hidden="true">2.21.2.</strong> Lowering MIR</a></li><li class=""><a href="backend/codegen.html"><strong aria-hidden="true">2.21.3.</strong> Code Generation</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class=""><a href="backend/updating-llvm.html"><strong aria-hidden="true">2.21.3.1.</strong> Updating LLVM</a></li><li class=""><a href="backend/debugging.html"><strong aria-hidden="true">2.21.3.2.</strong> Debugging LLVM</a></li><li class=""><a href="backend/backend-agnostic.html"><strong aria-hidden="true">2.21.3.3.</strong> Backend Agnostic Codegen</a></li></ol></li><li class=""><a href="profile-guided-optimization.html"><strong aria-hidden="true">2.21.4.</strong> Profile-guided Optimization</a></li><li class=""><a href="sanitizers.html"><strong aria-hidden="true">2.21.5.</strong> Sanitizers Support</a></li><li class=""><a href="debugging-support-in-rustc.html"><strong aria-hidden="true">2.21.6.</strong> Debugging Support in Rust Compiler</a></li><li class="spacer"></li></ol></li></ol></li><li class="expanded "><a href="appendix/stupid-stats.html">Appendix A: Stupid Stats</a></li><li class="expanded affix "><a href="appendix/background.html">Appendix B: Background material</a></li><li class="expanded affix "><a href="appendix/glossary.html">Appendix C: Glossary</a></li><li class="expanded affix "><a href="appendix/code-index.html">Appendix D: Code Index</a></li><li class="expanded affix "><a href="appendix/compiler-lecture.html">Appendix E: Compiler Lecture Series</a></li><li class="expanded affix "><a href="appendix/bibliography.html">Appendix F: Bibliography</a></li><li class="expanded affix "><a href="appendix/humorust.html">Appendix Z: HumorRust</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Guide to Rustc Development</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                            <a href="https://github.com/rust-lang/rustc-dev-guide" title="Git repository" aria-label="Git repository">
                                <i id="git-repository-button" class="fa fa-github"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#generics-and-substitutions" id="generics-and-substitutions">Generics and substitutions</a></h1>
<p>Given a generic type <code>MyType&lt;A, B, …&gt;</code>, we may want to swap out the generics <code>A, B, …</code> for some
other types (possibly other generics or concrete types). We do this a lot while doing type
inference, type checking, and trait solving. Conceptually, during these routines, we may find out
that one type is equal to another type and want to swap one out for the other and then swap that out
for another type and so on until we eventually get some concrete types (or an error).</p>
<p>In rustc this is done using the <code>SubstsRef</code> that we mentioned above (“substs” = “substitutions”).
Conceptually, you can think of <code>SubstsRef</code> of a list of types that are to be substituted for the
generic type parameters of the ADT.</p>
<p><code>SubstsRef</code> is a type alias of <code>List&lt;GenericArg&lt;'tcx&gt;&gt;</code> (see <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.List.html"><code>List</code> rustdocs</a>).
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/struct.GenericArg.html"><code>GenericArg</code></a> is essentially a space-efficient wrapper around <a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/enum.GenericArgKind.html"><code>GenericArgKind</code></a>, which is an enum
indicating what kind of generic the type parameter is (type, lifetime, or const).  Thus, <code>SubstsRef</code>
is conceptually like a <code>&amp;'tcx [GenericArgKind&lt;'tcx&gt;]</code> slice (but it is actually a <code>List</code>).</p>
<p>So why do we use this <code>List</code> type instead of making it really a slice? It has the length &quot;inline&quot;,
so <code>&amp;List</code> is only 32 bits. As a consequence, it cannot be &quot;subsliced&quot; (that only works if the
length is out of line).</p>
<p>This also implies that you can check two <code>List</code>s for equality via <code>==</code> (which would be not be
possible for ordinary slices). This is precisely because they never represent a &quot;sub-list&quot;, only the
complete <code>List</code>, which has been hashed and interned.</p>
<p>So pulling it all together, let’s go back to our example above:</p>
<pre><code class="language-rust ignore">struct MyStruct&lt;T&gt;
</code></pre>
<ul>
<li>There would be an <code>AdtDef</code> (and corresponding <code>DefId</code>) for <code>MyStruct</code>.</li>
<li>There would be a <code>TyKind::Param</code> (and corresponding <code>DefId</code>) for <code>T</code> (more later).</li>
<li>There would be a <code>SubstsRef</code> containing the list <code>[GenericArgKind::Type(Ty(T))]</code>
<ul>
<li>The <code>Ty(T)</code> here is my shorthand for entire other <code>ty::Ty</code> that has <code>TyKind::Param</code>, which we
mentioned in the previous point.</li>
</ul>
</li>
<li>This is one <code>TyKind::Adt</code> containing the <code>AdtDef</code> of <code>MyStruct</code> with the <code>SubstsRef</code> above.</li>
</ul>
<p>Finally, we will quickly mention the
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/struct.Generics.html"><code>Generics</code></a> type. It
is used to give information about the type parameters of a type.</p>
<h3><a class="header" href="#unsubstituted-generics" id="unsubstituted-generics">Unsubstituted Generics</a></h3>
<p>So above, recall that in our example the <code>MyStruct</code> struct had a generic type <code>T</code>. When we are (for
example) type checking functions that use <code>MyStruct</code>, we will need to be able to refer to this type
<code>T</code> without actually knowing what it is. In general, this is true inside all generic definitions: we
need to be able to work with unknown types. This is done via <code>TyKind::Param</code> (which we mentioned in
the example above).</p>
<p>Each <code>TyKind::Param</code> contains two things: the name and the index. In general, the index fully
defines the parameter and is used by most of the code. The name is included for debug print-outs.
There are two reasons for this. First, the index is convenient, it allows you to include into the
list of generic arguments when substituting. Second, the index is more robust. For example, you
could in principle have two distinct type parameters that use the same name, e.g. <code>impl&lt;A&gt; Foo&lt;A&gt; { fn bar&lt;A&gt;() { .. } }</code>, although the rules against shadowing make this difficult (but those language
rules could change in the future).</p>
<p>The index of the type parameter is an integer indicating its order in the list of the type
parameters. Moreover, we consider the list to include all of the type parameters from outer scopes.
Consider the following example:</p>
<pre><code class="language-rust ignore">struct Foo&lt;A, B&gt; {
  // A would have index 0
  // B would have index 1

  .. // some fields
}
impl&lt;X, Y&gt; Foo&lt;X, Y&gt; {
  fn method&lt;Z&gt;() {
    // inside here, X, Y and Z are all in scope
    // X has index 0
    // Y has index 1
    // Z has index 2
  }
}
</code></pre>
<p>When we are working inside the generic definition, we will use <code>TyKind::Param</code> just like any other
<code>TyKind</code>; it is just a type after all. However, if we want to use the generic type somewhere, then
we will need to do substitutions.</p>
<p>For example suppose that the <code>Foo&lt;A, B&gt;</code> type from the previous example has a field that is a
<code>Vec&lt;A&gt;</code>. Observe that <code>Vec</code> is also a generic type. We want to tell the compiler that the type
parameter of <code>Vec</code> should be replaced with the <code>A</code> type parameter of <code>Foo&lt;A, B&gt;</code>. We do that with
substitutions:</p>
<pre><code class="language-rust ignore">struct Foo&lt;A, B&gt; { // Adt(Foo, &amp;[Param(0), Param(1)])
  x: Vec&lt;A&gt;, // Adt(Vec, &amp;[Param(0)])
  ..
}

fn bar(foo: Foo&lt;u32, f32&gt;) { // Adt(Foo, &amp;[u32, f32])
  let y = foo.x; // Vec&lt;Param(0)&gt; =&gt; Vec&lt;u32&gt;
}
</code></pre>
<p>This example has a few different substitutions:</p>
<ul>
<li>In the definition of <code>Foo</code>, in the type of the field <code>x</code>, we replace <code>Vec</code>'s type parameter with
<code>Param(0)</code>, the first parameter of <code>Foo&lt;A, B&gt;</code>, so that the type of <code>x</code> is <code>Vec&lt;A&gt;</code>.</li>
<li>In the function <code>bar</code>, we specify that we want a <code>Foo&lt;u32, f32&gt;</code>. This means that we will
substitute <code>Param(0)</code> and <code>Param(1)</code> with <code>u32</code> and <code>f32</code>.</li>
<li>In the body of <code>bar</code>, we access <code>foo.x</code>, which has type <code>Vec&lt;Param(0)&gt;</code>, but <code>Param(0)</code> has been
substituted for <code>u32</code>, so <code>foo.x</code> has type <code>Vec&lt;u32&gt;</code>.</li>
</ul>
<p>Let’s look a bit more closely at that last substitution to see why we use indexes. If we want to
find the type of <code>foo.x</code>, we can get generic type of <code>x</code>, which is <code>Vec&lt;Param(0)&gt;</code>. Now we can take
the index <code>0</code> and use it to find the right type substitution: looking at <code>Foo</code>'s <code>SubstsRef</code>, we
have the list <code>[u32, f32]</code> , since we want to replace index <code>0</code>, we take the 0-th index of this
list, which is <code>u32</code>. Voila!</p>
<p>You may have a couple of followup questions…</p>
<p><strong><code>type_of</code></strong> How do we get the “generic type of <code>x</code>&quot;? You can get the type of pretty much anything
with the   <code>tcx.type_of(def_id)</code> query. In this case, we would pass the <code>DefId</code> of the field <code>x</code>.
The <code>type_of</code> query always returns the definition with the generics that are in scope of the
definition. For example, <code>tcx.type_of(def_id_of_my_struct)</code> would return the “self-view” of
<code>MyStruct</code>: <code>Adt(Foo, &amp;[Param(0), Param(1)])</code>.</p>
<p><strong><code>subst</code></strong> How do we actually do the substitutions? There is a function for that too! You use
<a href="https://doc.rust-lang.org/nightly/nightly-rustc/rustc/ty/subst/trait.Subst.html"><code>subst</code></a> to
replace a <code>SubstRef</code> with another list of types.</p>
<p><a href="https://github.com/rust-lang/rust/blob/597f432489f12a3f33419daa039ccef11a12c4fd/src/librustc_typeck/astconv.rs#L942-L953">Here is an example of actually using <code>subst</code> in the compiler</a>.  The exact details are not
too important, but in this piece of code, we happen to be converting from the <code>rustc_hir::Ty</code> to
a real <code>ty::Ty</code>. You can see that we first get some substitutions (<code>substs</code>).  Then we call
<code>type_of</code> to get a type and call <code>ty.subst(substs)</code> to get a new version of <code>ty</code> with
the substitutions made.</p>
<p><strong>Note on indices:</strong> It is possible for the indices in <code>Param</code> to not match with what we expect. For
example, the index could be out of bounds or it could be the index of a lifetime when we were
expecting a type. These sorts of errors would be caught earlier in the compiler when translating
from a <code>rustc_hir::Ty</code> to a <code>ty::Ty</code>. If they occur later, that is a compiler bug.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="ty.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="ty-fold.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="ty.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="ty-fold.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
